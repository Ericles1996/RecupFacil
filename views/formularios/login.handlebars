
    <div class="center-page">
    <div class="login-container">
        <h2>Login</h2>
        <div id="login-alert" class="alert alert-error" role="alert" style="display:none"></div>
        <form id="login-form" action="/login" method="POST" novalidate>
            <div class="form-group">
                <label for="username">Email</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">Senha</label>
                <div class="input-with-toggle" style="position:relative;">
                  <input type="password" id="password" name="password" required style="padding-right:44px;">
                  <button
                    type="button"
                    id="togglePasswordLogin"
                    aria-label="Mostrar senha"
                    aria-pressed="false"
                    style="position:absolute; right:8px; top:50%; transform:translateY(-50%); height:30px; min-width:30px; display:inline-flex; align-items:center; justify-content:center; background:transparent; border:1px solid rgba(255,255,255,.25); border-radius:6px; color:inherit; cursor:pointer;"
                    title="Mostrar/Ocultar senha"
                  >
                    <span id="toggleIcon" aria-hidden="true">Mostrar</span>
                  </button>
                </div>
            </div>
            <div class="form-actions"> 
                <button type="submit">Entrar</button>
                <button type="button" class="cancel-button" onclick="history.back()">Cancelar</button>

            </div>
        </form>
        <p>Ainda não tem uma conta? <a href="/cadastro">Cadastre-se aqui</a>.</p>
    </div>
    </div>
    
    <script>
    (function(){
      const form = document.getElementById('login-form');
      const alertBox = document.getElementById('login-alert');
      if(!form) return;
      form.addEventListener('submit', async function(e){
        e.preventDefault();
        alertBox.style.display = 'none';
        const formData = new FormData(form);
        const payload = new URLSearchParams();
        for (const [k,v] of formData.entries()) payload.append(k, v);
        try {
          const resp = await fetch(form.action, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: payload.toString(),
            credentials: 'same-origin'
          });
          if (resp.status === 401) {
            let data = {};
            try { data = await resp.json(); } catch(_) {}
            const msg = (data && data.message) ? data.message : 'E-mail ou senha inválidos.';
            alertBox.textContent = msg;
            alertBox.style.display = 'block';
            return;
          }
          if (resp.ok) {
            if (resp.redirected && resp.url) {
              window.location.href = resp.url;
            } else {
              window.location.href = '/home';
            }
            return;
          }
          alertBox.textContent = 'Erro no servidor. Tente novamente.';
          alertBox.style.display = 'block';
        } catch(err) {
          alertBox.textContent = 'Falha de rede. Verifique sua conexão.';
          alertBox.style.display = 'block';
        }
      });
    })();
    (function(){
      const input = document.getElementById('password');
      const btn = document.getElementById('togglePassword');
      const icon = document.getElementById('toggleIcon');
      if (!input || !btn) return;
      btn.addEventListener('click', function(e){
        e.preventDefault();
        e.stopPropagation();
        const isText = input.type === 'text';
        input.type = isText ? 'password' : 'text';
        btn.setAttribute('aria-label', isText ? 'Mostrar senha' : 'Ocultar senha');
        btn.setAttribute('aria-pressed', (!isText).toString());
        if (icon) icon.textContent = isText ? '???' : '??';
      });
    })();
    </script>
    <script src="js/script.js"></script> 


